<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <link rel="shortcut icon" href="NdcLogo4848.ico" type="image/x-icon">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Vial (Ndc) 虚拟股票系统</title>
        <link rel="stylesheet" type="text/css" href="index_style.css">
        <script type="text/javascript" src="echarts.js"></script>
        <script type="text/javascript" src="data.js"></script>
        <ul class="gray">
            <li class="av"><img src="NdcLogo4848.ico"></li>
            <li class="s"><a>Vial 虚拟股票系统</a></li>
            <li class="av"><a href="index.html">主页</a></li>
            <li class="av"><a href="news.html">新闻</a></li>
            <li class="av acc"><a href="mygp.html">我的股票</a></li>
            <li class="av"><a href="buy.html">购买股票</a></li>
            <li class="av"><a href="upld.html">充值</a></li>
            <li class="av"><a href="chnm.html">更改账户名</a></li>
            <li class="av"><a href="cpcq.html">抽奖</a></li>
            <li class="rightli av"><a href="https://space.bilibili.com/3461576468203796">Vial频道出品</a></li>
            <li class="rightli s"><a id="cnt"></a></li>
        </ul>
        <style>
        #echarts{
            display: flex;
            flex-wrap:wrap;
            width: 100%;
            justify-content:space-around;
        }
        #first{
            width: 48%;
            height: 600px;
            display: inline-block; 
            box-shadow: 1px 1px 10px #888888;
            border-radius: 30px;   
            margin-top: 20px;
        }
        #second{
            width: 48%;
            height: 600px;
            display: inline-block;  
            border-radius: 30px;   
            box-shadow: 1px 1px 10px #888888;  
            margin-top: 20px;
        }
        #first1{
            width: 100%;
            height: 600px;
            display: inline-block; 
            box-shadow: 1px 1px 10px #888888;
            border-radius: 30px;   
            margin-top: 20px;
        }
        @media screen and (max-width:957px){
            #first{
                width: 957px;
            }
            #second{
                width: 957px;
            }
        }
    </style>
    </head>
    <body>
        <script type="text/javascript">
            if(typeof(Storage)!=="undefined")
            {
                if(isNaN(Number(localStorage.money)))
                {
                    localStorage.money=0;
                }
                if(isNaN(Number(localStorage.nn)))
                {
                    localStorage.nn=1;
                }
                if(Number(localStorage.nn)==1&&Number(localStorage.money)==0)
                {
                    localStorage.name="新用户"+Math.floor(Math.random()*(100000-0+1));
                    localStorage.nn=0;
                }
                let nnn=Number(localStorage.money);
        	    document.addEventListener("DOMContentLoaded", function(){
        	        document.getElementById("cnt").innerText = "你好，"+localStorage.name+"。您还剩余约 " + nnn.toFixed(2) + " Orgent币。";
        	        document.getElementById("cnt1").innerText = "您的Ndc ID当前还剩余 " + nnn.toFixed(2) + " Orgent币。";
        	    });
            }
            else
            {
                document.addEventListener("DOMContentLoaded", function() {
                    alert("您的设备可能不支持 localStorge，暂时无法正常使用 Ndc股票系统。")
                });
            }
        </script>
        <div id="echarts">
        <div id="first"></div>
    <script>
        window.onresize = function() {
            myChart.resize();
        };
        var chartDom = document.getElementById('first');
        var myChart = echarts.init(chartDom);
        var option;
        var option = {
            title: {
                text: '我购买的股票'
            },
                xAxis: {
                    interval: 0,
                    data: [buycheckname(localStorage.sel1),buycheckname(localStorage.sel2),buycheckname(localStorage.sel3)],
                    axisLabel: {
      interval: 0,
      rotate: 0, 
      margin: 20,
      fontSize: 12,
      formatter: function(value) {
        if (value.length > 15) {
          return value.substring(0, 15) + '...'; 
        }
        return value;
      }
    }
                },
                yAxis: {},
                series: [
                    {
                        type: 'bar',
                        data: [localStorage.buy1,localStorage.buy2,localStorage.buy3]
                    },
                    {
                        type: 'bar',
                        data: [(buychecknowprice(localStorage.sel1)/localStorage.p1*1.000*localStorage.buy1),(buychecknowprice(localStorage.sel2)/localStorage.p2*1.000*localStorage.buy2),(buychecknowprice(localStorage.sel3)/localStorage.p3*1.000*localStorage.buy3)]
                    }
                ]  
        };
        option && myChart.setOption(option);
    </script>
</div>
<p>&nbsp;</p>
<p>绿色：当前实际剩余的钱数（还剩多少），蓝色：你购买的钱数（刚开始）。</p>
<p></p>
<p>选中股票</p>
<center>
<div>
    <input type="checkbox" id="one">第1个 &nbsp; &nbsp;<input type="checkbox" id="two">第2个 &nbsp; &nbsp;<input type="checkbox" id="three">第3个 &nbsp; &nbsp;
</div>
<script>
    if(localStorage.sel1=="0")
    {
        document.getElementById("one").disabled=true;
    }
    if(localStorage.sel2=="0")
    {
        document.getElementById("two").disabled=true;
    }
    if(localStorage.sel3=="0")
    {
        document.getElementById("three").disabled=true;
    }

    function Sell() {
            let hasSold = false;
            if (document.getElementById("one").checked) {
                const sel1 = localStorage.sel1;
                const buy1 = Number(localStorage.buy1);
                if (buy1 <= 0||(Number(Date.now())-Number(localStorage.d1))<=86400) {
                    alert("无法卖出第1个股票或未满12小时");
                    return;
                }
                const nowPrice = buychecknowprice(sel1);
                const pastPrice = buycheckpastprice(sel1);
                const nowValue = (buy1 * nowPrice / localStorage.p1).toFixed(2);
                const profit = (nowValue - buy1).toFixed(2); // 盈利/亏损
                const confirmMsg = `确定卖出股票[${buycheckname(sel1)}]吗？\n` +
                                  `购买金额：${buy1} Orgent币\n` +
                                  `当前市值：${nowValue} Orgent币\n` +
                                  `${profit >= 0 ? '盈利' : '亏损'}：${Math.abs(profit)} Orgent币`;
                if (!confirm(confirmMsg)) return;
                localStorage.money = (Number(localStorage.money) + Number(nowValue)).toFixed(2);
                localStorage.sel1 = 0;
                localStorage.buy1 = 0;
                localStorage.p1=0;
                localStorage.d1=0;
                hasSold = true;
            }
            if (document.getElementById("two").checked) {
                const sel2 = localStorage.sel2;
                const buy2 = Number(localStorage.buy2);
                if (buy2 <= 0||(Number(Date.now())-Number(localStorage.d2))<=86400) {
                    alert("无法卖出第2个股票或未满12小时");
                    return;
                }
                const nowPrice = buychecknowprice(sel2);
                const pastPrice = buycheckpastprice(sel2);
                const nowValue = (buy2 * nowPrice / localStorage.p2).toFixed(2);
                const profit = (nowValue - buy2).toFixed(2);

                const confirmMsg = `确定卖出股票[${buycheckname(sel2)}]吗？\n` +
                                  `购买金额：${buy2} Orgent币\n` +
                                  `当前市值：${nowValue} Orgent币\n` +
                                  `${profit >= 0 ? '盈利' : '亏损'}：${Math.abs(profit)} Orgent币`;
                if (!confirm(confirmMsg)) return;

                localStorage.money = (Number(localStorage.money) + Number(nowValue)).toFixed(2);
                localStorage.sel2 = 0;
                localStorage.buy2 = 0;
                localStorage.p2=0;
                localStorage.d2=0;
                hasSold = true;
            }
            if (document.getElementById("three").checked)
            {
                const sel3 = localStorage.sel3;
                const buy3 = Number(localStorage.buy3);
                if (buy3 <= 0||(Number(Date.now())-Number(localStorage.d3))<=86400) {
                    alert("无法卖出第3个股票或未满12小时");
                    return;
                }
                const nowPrice = buychecknowprice(sel3);
                const pastPrice = buycheckpastprice(sel3);
                const nowValue = (buy3 * nowPrice / localStorage.p3).toFixed(2);
                const profit = (nowValue - buy3).toFixed(2);

                const confirmMsg = `确定卖出股票 [${buycheckname(sel3)}] 吗？\n` +
                                  `购买金额：${buy3} Orgent币\n` +
                                  `当前市值：${nowValue} Orgent币\n` +
                                  `${profit >= 0 ? '盈利' : '亏损'}：${Math.abs(profit)} Orgent币`;
                if (!confirm(confirmMsg)) return;

                localStorage.money = (Number(localStorage.money) + Number(nowValue)).toFixed(2);
                localStorage.sel3 = 0;
                localStorage.buy3 = 0;
                localStorage.p3=0;
                localStorage.d3=0;
                hasSold = true;
            }
            if (!hasSold)
            {
                alert("请先选中要卖出的股票。");
                return;
            }
            window.location.href = "mygp.html";
        }
</script>
</center>
<p>&nbsp;</p>
    <center><button class="btn" onclick="javascript:window.location.href='./buy.html';">购买股票</button> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <button class="btn" id="sll" onclick="javascript:Sell()">卖出股票</button> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <button class="btn" onclick="javascript:window.location.href='./upld.html';">充值</button></center>
    </body>

</html>




